## -------------------------------------------------------------------------------
## userver - configuration parameters
## -------------------------------------------------------------------------------

userver {

#include "userver.cfg"

   PORT 5280 # nocat

## RUN_AS_USER apache

   USE_TCP_OPTIMIZATION yes

   DOCUMENT_ROOT  nocat

## LOG_FILE       syslog
   LOG_FILE       nocat.log
   LOG_FILE_SZ    1M
   LOG_MSG_SIZE   -1

   PLUGIN      "mod_nocat mod_http"
   PLUGIN_DIR  ../../../src/ulib/net/server/plugin/.libs

## -----------------------------------------------------------------------
## NB: MUST BE IN THIS WAY... (otherwise cannot share hash table of peers)
## -----------------------------------------------------------------------
   PREFORK_CHILD 0
## -----------------------------------------------------------------------
}

## --------------------------------------------------------------------------------------------------------------------
## mod_nocat - plugin parameters
## --------------------------------------------------------------------------------------------------------------------
## FW_ENV                environment for shell script to execute
## FW_CMD                shell script to manage the firewall
##
## LOGOUT_URL            URL to redirect user after logout
## PUBLIC_ADDRESS        address to contat access point from portal
## INTERNAL_DEVICE_LABEL radio tag to be used from portal
##
## DECRYPT_CMD           PGP command stuff
## DECRYPT_KEY           DES3 password stuff
##
## LOGIN_TIMEOUT         Number of seconds after a client last login/renewal to terminate their connection
## CHECK_BY_ARPING       metodo aggiuntivo per verificare la presenza di un peer nella tabella ARP (yes -> abilitato)
## CHECK_EXPIRE_INTERVAL Number of seconds to check if some client has terminate their connection
## --------------------------------------------------------------------------------------------------------------------

mod_nocat {

   ## shell script to manage the firewall

   FW_ENV "DEBUG=1 \
           FW_CONF=etc/nodog_fw.conf \
           AllowedWebHosts=159.213.0.0/16 \
           ExternalDevice=ath0 \
           'InternalDevice=ath0 ath0' \
           'LocalNetwork=10.30.1.0/24 10.1.0.1/16' \
           'AuthServiceAddr=http://www.auth-firenze.com:5280/login http://localhost'"

   FW_CMD  firewall/nodog.fw

   INTERNAL_DEVICE_LABEL "radio1 radio2"

   ## URL to redirect user after logout
   LOGOUT_URL         "http://www.auth-firenze.com/logout http://localhost/logout"

   ## address to contat access point from portal
   PUBLIC_ADDRESS     10.30.1.131:5280

   ## PGP command stuff
## DECRYPT_CMD       "/usr/bin/gpg --decrypt --homedir=/usr/share/nocat/pgp --batch --decrypt --no-tty --status-file /tmp/gpg.status -o -"

   ## DES3 password stuff
   DECRYPT_KEY       200912281747

   ## Number of seconds after a client last login/renewal to terminate their connection
   ## Probably do not want to set this to less than 60 or a lot of bandwidth is likely to get consumed by the client renewal attempts
## LOGIN_TIMEOUT     86400 # one notification per day

   ## metodo aggiuntivo per verificare la presenza di un peer nella tabella ARP (yes -> abilitato)
   CHECK_BY_ARPING yes

   # Number of seconds to check if some client has terminate their connection
   CHECK_EXPIRE_INTERVAL 360
}

## ------------------------------------------------------------------------------------------------------------------------------------------------
## mod_http - plugin parameters
## ------------------------------------------------------------------------------------------------------------------------------------------------
## ALIAS                      vector of URI redirection (request -> alias)
## REWRITE_RULE_NF            vector of URI rewrite rule applied after checks that files do not exist (regex1 -> uri1 ...)
## VIRTUAL_HOST               flag to activate practice of maintaining more than one server on one machine, as differentiated by their apparent hostname 
## CACHE_FILE_MASK            mask (DOS regexp) of pathfile that be cached in memory
## DIGEST_AUTHENTICATION      flag authentication method (yes = digest, no = basic)
## URI_PROTECTED_MASK         mask (DOS regexp) of URI protected from prying eyes
## URI_PROTECTED_ALLOWED_IP   list of comma separated client address for IP-based access control (IPADDR[/MASK]) for URI_PROTECTED_MASK
## ------------------------------------------------------------------------------------------------------------------------------------------

mod_http {

   ## Allows you to tell clients about documents that used to exist in your server's namespace, but do not anymore.
   ## The client will make a request for the document at its new location
   ALIAS [
         /login     /cgi-bin/index.sh
         /printenv  /cgi-bin/printenv.sh
         ]

   ## vector of URI rewrite rule applied after checks that files do not exist (regex1 -> uri1 ...)

## REWRITE_RULE_NF [
##                 ^/.*\.[A-Za-z0-9]+.*?$ $0
##                 ^/(.*?)(\?|$)(.*)      /sapphire/main.php?url=$1&$3
##                 ]

## VIRTUAL_HOST     yes
## CACHE_FILE_MASK  *.jpg|*.png|*.gif

   DIGEST_AUTHENTICATION yes

   URI_PROTECTED_MASK         /cgi-bin/*
## URI_PROTECTED_ALLOWED_IP   127.0.0.1,10.30.0.0/16
}
