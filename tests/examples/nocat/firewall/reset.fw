#!/bin/sh

# reset.fw: reset the default firewall rules
# ---------------------------------------------------------------------------------------------------------------------------------------------------
# PARAMETERS: 1
# ---------------------------------------------------------------------------------------------------------------------------------------------------
# RouteOnly  Optional. Required only if you DO NOT want your gateway to act as a NAT. Give this only if you're running a strictly routed
#            network, and don't need the gateway to enable NAT for you
# ---------------------------------------------------------------------------------------------------------------------------------------------------
OPT=/tmp/firewall.opt

if [ -f $OPT ]; then
   i=1
   while read LINE
   do
      eval v$i=\"$LINE\"
      let "i = i + 1"
   done < $OPT
fi

RouteOnly="$v1"

# Note: your PATH is inherited from the gateway process

IPTABLES=/usr/sbin/iptables

# Flush all user-defined chains
#
$IPTABLES -t filter -D FORWARD -j NoCat 2>/dev/null

$IPTABLES -t nat -D PREROUTING -j NoCat_Capture 2>/dev/null

# Only nat if we're not routing
#
if [ -z "$RouteOnly" ]; then
  $IPTABLES -t nat -D POSTROUTING -j NoCat_NAT 2>/dev/null
fi

$IPTABLES -t mangle -D PREROUTING -j NoCat 2>/dev/null

exit 0
