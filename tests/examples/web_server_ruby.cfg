## -------------------------------------------------------------------------------
## userver - configuration parameters
## -------------------------------------------------------------------------------

userver {

   RUN_AS_USER  apache

   USE_TCP_OPTIMIZATION yes

   DOCUMENT_ROOT  ruby

   LOG_FILE       web_server_ruby.log
   LOG_FILE_SZ    1M
   LOG_MSG_SIZE   -1

   REQ_TIMEOUT 30

   PLUGIN   "mod_fcgi mod_http"

   PLUGIN_DIR ../../../src/ulib/net/server/plugin/.libs

#  PREFORK_CHILD  -1
}

## ------------------------------------------------------------------------------------------------------------------------------------------------
## mod_http - plugin parameters
## ------------------------------------------------------------------------------------------------------------------------------------------------
## ALIAS                      vector of URI redirection (request -> alias)
## REWRITE_RULE_NF            vector of URI rewrite rule applied after checks that files do not exist (regex1 -> uri1 ...)
##
## ENABLE_INOTIFY             enable automatic update of cached document root image with inotify
## CACHE_FILE_MASK            mask (DOS regexp) of pathfile that be cached in memory
##
## VIRTUAL_HOST               flag to activate practice of maintaining more than one server on one machine, as differentiated by their apparent hostname 
## DIGEST_AUTHENTICATION      flag authentication method (yes = digest, no = basic)
##
## URI_PROTECTED_MASK         mask (DOS regexp) of URI protected from prying eyes
## URI_PROTECTED_ALLOWED_IP   list of comma separated client address for IP-based access control (IPADDR[/MASK]) for URI_PROTECTED_MASK
##
## This directive gives greater control over abnormal client request behavior, which may be useful for avoiding some forms of denial-of-service attacks
##
## LIMIT_REQUEST_BODY         restricts the total size of the HTTP request body sent from the client
## REQUEST_READ_TIMEOUT       set timeout for receiving requests
## ------------------------------------------------------------------------------------------------------------------------------------------------

mod_http {

   ## Allows you to tell clients about documents that used to exist in your server's namespace, but do not anymore.
   ## The client will make a request for the document at its new location
   ALIAS [
         /  /test.rb.fcgi
         ]

   ## vector of URI rewrite rule applied after checks that files do not exist (regex1 -> uri1 ...)
   REWRITE_RULE_NF [
#                  ^/.*\.[A-Za-z0-9]+.*?$ $0
#                  ^/(.*?)(\?|$)(.*)      /sapphire/main.php?url=$1&$3
                   ]

#  ENABLE_INOTIFY        yes
#  CACHE_FILE_MASK       *.jpg|*.png|*.css|*.js|*.gif

## VIRTUAL_HOST          yes
## DIGEST_AUTHENTICATION yes

  ## This directive gives greater control over abnormal client request behavior, which may be useful for avoiding some forms of denial-of-service attacks
# LIMIT_REQUEST_BODY         700K
# REQUEST_READ_TIMEOUT       30 
}

# -----------------------------------------------------------------------------------------------
# mod_fcgi - plugin parameters
# -----------------------------------------------------------------------------------------------
# FCGI_URI_MASK  mask (DOS regexp) of uri type that send request via FCGI (*.php)
#
# SOCKET_NAME    name file for the listening socket
#
# SERVER         host name or ip address for server
# PORT           port number for the server
#
# RES_TIMEOUT    timeout for response from server FCGI
# FCGI_KEEP_CONN If not zero, the server FCGI does not close the connection after
#                responding to request; the plugin retains responsibility for the connection
#
# LOG_FILE       location for file log (use server log if same value)
# -----------------------------------------------------------------------------------------------

mod_fcgi {

  FCGI_URI_MASK *.fcgi

  SOCKET_NAME   ../tmp/fcgi.socket

# SERVER        10.30.1.131
# PORT          8080

  RES_TIMEOUT    20
  FCGI_KEEP_CONN yes

  LOG_FILE      web_server_ruby.log
}
