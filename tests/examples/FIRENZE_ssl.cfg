## -------------------------------------------------------------------------------
## userver - configuration parameters
## -------------------------------------------------------------------------------

userver {

## ----------------------------------------------------------------------------------------------------------------------------------------
## USE_IPV6      flag to indicate use of ipv6
## SERVER        host name or ip address for the listening socket
## PORT          port number             for the listening socket
## IP_ADDRESS    public ip address of host for the interface connected to the Internet (autodetected if not specified)
## SOCKET_NAME   file name               for the listening socket
## ALLOWED_IP    client address IP-based access control (IPADDR[/MASK])
##
## USE_TCP_OPTIMIZATION flag indicating the use of TCP/IP options to optimize data transmission (NODELAY/CORK, DEFER_ACCEPT, QUICKACK)
##
## PID_FILE      write pid on file indicated
## WELCOME_MSG   message of welcome to send initially to client
## RUN_AS_USER   change the current working directory to the user home dir, and downgrade security to that user account
## DOCUMENT_ROOT The directory out of which you will serve your documents
##
## LOG_FILE      locations   for file log
## LOG_FILE_SZ   memory size for file log
## LOG_MSG_SIZE  limit length of print network message to LOG_MSG_SIZE chars (default 128)
##
## PLUGIN        list of plugins to load, a flexible way to add specific functionality to the server
## PLUGIN_DIR    directory of plugins to load
##
## REQ_TIMEOUT   timeout for request from client
## CGI_TIMEOUT   timeout for cgi execution
##
## MAX_KEEP_ALIVE Specifies the maximum number of requests that can be served through a Keep-Alive (Persistent) session.
##                (Value <= 1 will disable Keep-Alive)
##
## CERT_FILE     certificate of server
## KEY_FILE      private key of server
## PASSWORD      password for private key of server
## CA_FILE       locations of trusted CA certificates used in the verification
## CA_PATH       locations of trusted CA certificates used in the verification
##
## VERIFY_MODE   mode of verification (SSL_VERIFY_NONE=0, SSL_VERIFY_PEER=1, SSL_VERIFY_FAIL_IF_NO_PEER_CERT=2, SSL_VERIFY_CLIENT_ONCE=4)
## ----------------------------------------------------------------------------------------------------------------------------------------
## how to verify peer certificates. The possible values of this setting are:
##
## SSL_VERIFY_NONE                 - do not verify anything
## SSL_VERIFY_PEER                 - verify the peer certificate, if one is presented
## SSL_VERIFY_FAIL_IF_NO_PEER_CERT - require a peer certificate, fail if one is not presented
##
## SSL/TLS servers will usually set VERIFY_MODE to  SSL_VERIFY_PEER                                      (OPTIONAL)
## SSL/TLS clients will usually set VERIFY_MODE to (SSL_VERIFY_PEER | SSL_VERIFY_FAIL_IF_NO_PEER_CERT)   (REQUIRE)
## ----------------------------------------------------------------------------------------------------------------------------------------
##
## PREFORK_CHILD number of child server processes created at startup ( 0 - serialize, no forking
##                                                                     1 - classic, forking after accept client)
##                                                                    >1 - pool of process serialize plus monitoring process)
## ----------------------------------------------------------------------------------------------------------------------------------------

## USE_IPV6       no
## SERVER         localhost
## SERVER         10.30.1.131
## SERVER         192.168.220.102
   PORT           443
   IP_ADDRESS     10.30.1.131
## ALLOWED_IP     127.0.0.1,10.30.0.0/16
## ALLOWED_IP     127.0.0.1,192.168.220.0/24

   PID_FILE       /var/run/userver_ssl.pid
## WELCOME_MSG    "220 david.unirel.intranet ULib WEB server (Version 1.1.0) ready.\n"
   DOCUMENT_ROOT  /srv/wifi-portal-firenze/www

   RUN_AS_USER    apache

   LOG_FILE       FIRENZE_ssl.log
   LOG_FILE_SZ    1M
   LOG_MSG_SIZE   -1

   PLUGIN         mod_http
   PLUGIN_DIR     /usr/src/ULib-1.1.0/src/ulib/net/server/plugin/.libs

## ------------------------------------------------------------------------------------------------------------------------------------------
## Max Keep-Alive Requests
## ------------------------------------------------------------------------------------------------------------------------------------------
## Description: Specifies the maximum number of requests that can be served through a Keep-Alive (Persistent) session.
##              Connection will be closed once this limit is reached.
## Syntax: Integer number
## Tips: [Performance] Set it to a resonable high value (256). Value <= 1 will disable Keep-Alive.
## ------------------------------------------------------------------------------------------------------------------------------------------

   MAX_KEEP_ALIVE 256

## ------------------------------------------------------------------------------------------------------------------------------------------
## Keep-Alive Timeout
## ------------------------------------------------------------------------------------------------------------------------------------------
## Description: Specifies the maximum idle time between requests from a Keep-Alive connection. If no new request is received during
##              this period of time, the connection will be closed.
## Syntax:      Integer number
## Tips: [Security & Performance] We recommend you to set the value just long enough to handle all requests for a single page view.
##       It is unnecessary to keep connection alive for an extended period of time. A smaller value can reduce idle connections, increase
##       capacity to service more users and guard against DoS attacks. 2-5 seconds is a reasonable range for most applications.
## ------------------------------------------------------------------------------------------------------------------------------------------

   REQ_TIMEOUT  30 
## CGI_TIMEOUT  60

#  CA_PATH     /srv/userver/etc/CApath
#  CA_FILE     /srv/userver/etc/CApath/ServerCerts.crt.pem
#  KEY_FILE    /srv/userver/etc/certificates/auth-firenze.unirel.intranet.key.pem
#  CERT_FILE   /srv/userver/etc/certificates/auth-firenze.unirel.intranet.crt.pem

   CA_PATH     /usr/src/ULib-1.1.0/tests/ulib/CA/CApath
   CA_FILE     /usr/src/ULib-1.1.0/tests/ulib/CA/cacert.pem
   PASSWORD    caciucco
   KEY_FILE    /usr/src/ULib-1.1.0/tests/ulib/CA/server.key
   CERT_FILE   /usr/src/ULib-1.1.0/tests/ulib/CA/server.crt

   VERIFY_MODE 0
#  VERIFY_MODE 1

   PREFORK_CHILD  3
}

## ------------------------------------------------------------------------------------------------------------------------------------------
## mod_http - plugin parameters
## ------------------------------------------------------------------------------------------------------------------------------------------
## ALIAS                      vector of URI redirection (request -> alias)
## REWRITE_RULE_NF            vector of URI rewrite rule applied after checks that files do not exist (regex1 -> uri1 ...)
##
## CACHE_FILE_MASK            mask (DOS regexp) of pathfile that be cached in memory
##
## VIRTUAL_HOST               flag to activate practice of maintaining more than one server on one machine, as differentiated by their apparent hostname 
## DIGEST_AUTHENTICATION      flag authentication method (yes = digest, no = basic)
##
## URI_PROTECTED_MASK         mask (DOS regexp) of URI protected from prying eyes
## URI_PROTECTED_ALLOWED_IP   list of comma separated client address for IP-based access control (IPADDR[/MASK]) for URI_PROTECTED_MASK
##
## URI_REQUEST_CERT_MASK      mask (DOS regexp) of URI where client must comunicate a certificate in the SSL connection
## ------------------------------------------------------------------------------------------------------------------------------------------

mod_http {

   ## Allows you to tell clients about documents that used to exist in your server's namespace, but do not anymore.
   ## The client will make a request for the document at its new location

   ALIAS [
         /cpe                 /wi-auth/cgi-bin/cpe.sh
         /login               /wi-auth/cgi-bin/login.sh
         /registrazione       /wi-auth/cgi-bin/registrazione.sh
         /polling_attivazione /wi-auth/cgi-bin/polling_attivazione.sh

         /printenv            /wi-auth/cgi-bin/printenv.sh

         /admin                                      /admin/cgi-bin/admin.sh
         /view_user                                  /admin/cgi-bin/view_user.sh
         /recovery                                   /admin/cgi-bin/recovery.sh
         /printlog                                   /admin/cgi-bin/printlog.sh
         /status_ap                                  /admin/cgi-bin/status_ap.sh
         /status_network                             /admin/cgi-bin/status_network.sh
         /execute_recovery                           /admin/cgi-bin/execute_recovery.sh
         /view_statistics_login                      /admin/cgi-bin/view_statistics_login.sh
         /historical_statistics_login                /admin/cgi-bin/historical_statistics_login.sh
         /export_statistics_login_as_csv             /admin/cgi-bin/export_statistics_login_as_csv.sh
         /view_statistics_registration               /admin/cgi-bin/view_statistics_registration.sh
         /export_statistics_registration_as_csv      /admin/cgi-bin/export_statistics_registration_as_csv.sh
         ]

   CACHE_FILE_MASK       *.jpg|*.css|*.js|*.gif|*.png

## VIRTUAL_HOST          yes
## DIGEST_AUTHENTICATION yes

   URI_PROTECTED_MASK         /admin/cgi-bin/*
## URI_PROTECTED_ALLOWED_IP   127.0.0.1,10.30.0.0/16

   URI_REQUEST_CERT_MASK      /wi-auth/cgi-bin/cpe.sh
}
