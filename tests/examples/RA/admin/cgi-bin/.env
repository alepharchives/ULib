#!/bin/sh

set_ENV() {

	# global var
	BASE_NAME=$(basename $1 .sh)

	if [ -n "$HTTP_ACCEPT_LANGUAGE" -a -d ../../form/$HTTP_ACCEPT_LANGUAGE ]; then
		FORM_FILE_DIR=../../form/$HTTP_ACCEPT_LANGUAGE
	else
		FORM_FILE_DIR=../../form/en
	fi

	export BASE_NAME FORM_FILE_DIR
}

write_OUTPUT() {

	if [ -n "$1" ]; then

		echo -e "Content-Type: text/html; charset=iso-8859-1\r\n\r"
		echo -n -E "$1"

		exit 0

	fi
}

view_form_input() {

	printf -v OUTPUT "`cat $FORM_FILE_DIR/$BASE_NAME.tmpl`"
}

send_mail() {

	# directory to put mail to send...

	cd ../../mail

	DIR_SESSION=$BASE_NAME

	mkdir -p $DIR_SESSION

	printf "`cat $BASE_NAME.tmpl`" "$1" "$2" > $DIR_SESSION/send_to_$$.eml

	./sendmsg.sh $DIR_SESSION $$ >/dev/null 2>&1 &

	sleep 2

	# goto main menu...

	echo -e "Location: /RA\r\n\r"

	exit 0
}
